# Epic 10 Retrospective — Mobile Content: Posts, Journal & Social

**Date:** 2026-02-10
**Facilitator:** Bob (Scrum Master)
**Epic:** Epic 10 — Mobile Content: Posts, Journal & Social
**Status:** Complete (2/2 stories done)

## Epic Summary

Epic 10 launched the mobile phase of HomeCafe by connecting the Expo React Native app to the existing Next.js backend APIs. Two stories delivered journal/posts functionality (10.1) and social feed with reactions (10.2). This is the first epic that targets mobile-only, consuming backend APIs built during Epics 1-2 without any backend modifications.

### Delivery Metrics

- Stories completed: 2/2 (100%)
- Files created: 8 new files
- Files modified: 9 files
- Tests: 389 (0 new — mobile hooks tested via integration, no unit test additions)
- Code reviews: 2 adversarial reviews, all findings resolved
- Blockers: 0
- Production incidents: 0 (10th consecutive epic)

### Stories Delivered

| Story | Description | Scope | Files Created | Files Modified | Key Achievement |
|-------|-------------|-------|---------------|----------------|-----------------|
| 10.1 | Journal & Posts Mobile | Mobile API connection | 7 | 6 | 8 tasks, 4H+4M review findings fixed, shared utilities extracted |
| 10.2 | Social Feed & Reactions Mobile | Mobile API connection | 1 | 4 | useInfiniteQuery for infinite scroll, optimistic reactions, empty states |

## What Went Well

1. **Story Intelligence propagation continued to mature** — Story 10.2 explicitly referenced 10.1 learnings (SafeAreaView import source, shared utility extraction, optimistic like pattern). All 4 HIGH fixes from 10.1's code review were avoided in 10.2's initial implementation: like handlers called mutations from the start, HTML content preserved correctly, SafeAreaView imported from `react-native-safe-area-context` consistently.

2. **Zero new components created — full reuse strategy succeeded** — Both stories reused existing Expo components (`PublicPostCard`, `ActionBar`, `PostFeed`, `JournalHeader`) without creating new UI components. The mock-data-first approach from the Expo scaffold proved its value: components were already designed, tested visually, and ready for API connection.

3. **Code review caught critical functional gaps in both stories** — Story 10.1: 4 HIGH issues (like handlers not calling mutations, HTML stripped in editor, images undefined instead of empty array, SafeAreaView import). Story 10.2: 1 HIGH (infinite scroll not implemented despite being an AC). The adversarial review process continues to be the primary quality strategy, catching issues that would be user-visible.

4. **Shared utility extraction pattern established** — Story 10.1 extracted `formatPostDate()`, `formatPostTime()`, `stripHtml()` into `lib/utils/post-format.ts` and `usePostImages()` into `lib/hooks/use-image-picker.ts`. Story 10.2 imported and reused all of them. This sets a strong precedent for mobile utility organization.

5. **Cache invalidation strategy consolidated across stories** — By the end of Epic 10, `useTogglePostReaction()`, `useCreatePost()`, and `useDeletePost()` all invalidate `feedKeys.all`, `journalKeys.all`, and `postKeys.all`. Cross-story cache consistency is now complete for the content domain.

6. **Zero new libraries installed** — TanStack React Query, Expo Router, NativeWind, and lucide-react-native covered all requirements. No dependency bloat.

## What Didn't Go Well

1. **Implementations marked "done" but functionally incomplete — 2/2 stories** — Story 10.1: like handlers toggled local state but never called `useTogglePostReaction()` mutation (H1). Story 10.2: used `useQuery` for a single page instead of `useInfiniteQuery` for infinite scroll (H1), despite infinite scroll being explicit in AC #7. Pattern: the implementation satisfies the visual appearance but misses the functional behavior. Root cause: likely optimizing for "looks correct" over "works correctly."

2. **Cache invalidation gaps in 2/2 stories** — Story 10.1: `useTogglePostReaction()` didn't invalidate `feedKeys.all` (only `postKeys.all` and `journalKeys.all`). Story 10.2 code review added `feedKeys.all` to `useTogglePostReaction()` but missed `useCreatePost()` and `useDeletePost()` until M1 fix. Pattern: each mutation is wired to invalidate "obvious" caches but misses cross-feature caches. Root cause: no systematic cache invalidation matrix.

3. **Spec details not followed exactly — emoji string mismatch** — Story 10.2 sent `"❤️"` (emoji character) instead of `"heart"` (backend-expected string name) for reactions. The story spec explicitly listed `"heart"` in the allowed emoji names. Pattern: implementation used intuitive values instead of reading the spec contract. Caught in code review (bonus fix).

4. **No mobile-specific tests added** — 389 tests remained unchanged across both stories. All TanStack Query hooks (`useFriendFeed`, `useJournalEntries`, `useJournalStreak`, `usePost`, `useCreatePost`, etc.) have zero unit tests. Testing strategy relies entirely on backend BDD tests + manual verification. Risk accumulates as hook count grows.

5. **Biome pre-push hook fragility exposed** — Two pre-push failures during story 10.2 commit: (1) `console.warn` in catch block triggered `noConsole` warning, (2) pre-existing `noDangerouslySetInnerHtml` in landing page `page.tsx` (JSON-LD structured data). Discovered that `biome-ignore` JSX comments don't suppress attribute-level warnings — required `biome.json` overrides. Pattern: CI/CD tooling has edge cases that block delivery unexpectedly.

## Key Insights

1. **"Looks correct" vs "works correctly" — the mobile gap** — Mobile development with mock-data-first creates a visual illusion of completeness. The screen looks right with mock data, and when replaced with API calls, it still looks right — but functional behaviors (infinite scroll, mutation calls, cache invalidation) may be silently missing. Solution: acceptance criteria must be verified functionally, not visually.

2. **Cache invalidation needs a matrix, not ad-hoc wiring** — With 3 query key families (`feedKeys`, `journalKeys`, `postKeys`) and 4 mutations (`create`, `update`, `delete`, `toggleReaction`), the invalidation matrix is already 12 cells. Ad-hoc wiring per story leads to gaps. A documented invalidation matrix in the story spec would prevent this.

3. **useQuery vs useInfiniteQuery is a fundamental architecture choice** — Story 10.2 initially used `useQuery` (single page) when `useInfiniteQuery` (accumulated pages) was needed. This isn't a minor bug — it's an architecture decision that affects the hook signature, the screen's data flattening, and the scroll behavior. The story spec should explicitly state the query strategy.

4. **Biome override mechanism for legitimate exceptions** — `biome-ignore` comments work for line-level suppressions but not JSX attribute-level warnings. The `overrides` section in `biome.json` with file-specific rule disabling is the correct mechanism for legitimate exceptions (like JSON-LD `dangerouslySetInnerHTML`).

5. **Mobile phase validates backend API design** — Both stories consumed existing APIs without any backend modifications. The REST API contract (pagination, reaction toggle, feed response shape) worked seamlessly across web and mobile. This validates the API-first architecture decision from Epics 1-2.

## Previous Retrospective Follow-Through

### Epic 9 Action Items Status

| # | Action Item | Status | Evidence |
|---|---|---|---|
| 1 | Add diacritics/linguistic quality verification for French content in story template | ⏳ Not tested | Epic 10 stories had no hardcoded French content in specs (API-driven). Mechanism exists but untested. |
| 2 | Establish visual asset process — every meta image reference must have asset or debt ticket | ⏳ Not tested | Epic 10 was mobile-only, no new meta images referenced. OG image debt from Epic 9 still unresolved. |

**Score: 0/2 tested (both items not applicable to Epic 10's mobile scope)**

### Epic 9 Technical Debt Status

| # | Item | Epic 10 Status | Impact |
|---|---|---|---|
| 1 | db:push not executed | Unchanged | Now 10 epics of migrations not pushed. Risk continues to accumulate. |
| 2 | DeleteAccountUseCase missing | Unchanged | Not in scope for Epic 10. Tracked for Epic 15. |
| 3 | /og-landing.png missing | Unchanged | Not in scope for Epic 10. Tracked for Epic 15. |
| 4 | i18n not wired | Unchanged | Not in scope for Epic 10. Tracked for Epic 15. |
| 5 | Rich text as plain text in widget | Unchanged | Dashboard concern, not Epic 10. |

## Technical Debt

| # | Item | Severity | Description |
|---|---|---|---|
| 1 | db:push not executed | Medium | Database schema migrations generated but never pushed (10 epics). Dev local works. Production risk accumulating. |
| 2 | DeleteAccountUseCase missing | Medium | Settings page "Delete account" button performs sign-out as fallback. Tracked for Epic 15. |
| 3 | /og-landing.png missing | Medium | Referenced in OG/Twitter metadata but file does not exist. Tracked for Epic 15. |
| 4 | i18n not wired | Low | Language preference stored in DB but not applied to UI. Tracked for Epic 15. |
| 5 | Rich text as plain text in widget | Low | Post content rendered as plain text in dashboard widget preview. |
| 6 | Mobile hooks have zero unit tests | Medium | 8+ TanStack Query hooks created in Epic 10 with no test coverage. Relies entirely on backend BDD tests + manual verification. |
| 7 | Cache invalidation not systematically documented | Low | No matrix mapping mutations to query key invalidations. Ad-hoc wiring per story leads to gaps. |

## Action Items

| # | Action | Owner | Success Criteria |
|---|---|---|---|
| 1 | Add "infinite scroll / pagination strategy" decision to story template when story involves paginated data | Bob (SM) | Story spec explicitly states `useQuery` vs `useInfiniteQuery` and expected scroll behavior. No ambiguity in AC about pagination implementation. |
| 2 | Add cache invalidation matrix to story spec when story introduces or modifies mutations | Bob (SM) | Story spec includes table mapping each mutation to all query keys it must invalidate. Code review verifies matrix completeness. |
| 3 | Add "API contract values verified against spec" to Quality Checklist | Bob (SM) | Quality Checklist includes item for verifying enum values, string constants, and response shapes match the documented API contract exactly. |

## Team Agreements

- Paginated list screens MUST specify `useInfiniteQuery` vs `useQuery` in the story spec — no implicit assumptions
- Every mutation hook MUST document which query keys it invalidates — cache invalidation is an explicit design decision, not an afterthought
- API contract values (enum strings, endpoint paths, response shapes) MUST be verified against the spec, not assumed from intuition
- Code review must verify functional behavior (not just visual correctness) — especially for infinite scroll, mutation calls, and cache invalidation
- Story Intelligence from previous stories continues to be propagated and verified

## Readiness Assessment

| Area | Status | Notes |
|------|--------|-------|
| Testing & Quality | ✅ Clean | 389 tests, 0 errors, 0 Biome warnings (2 pre-existing suppressed) |
| Deployment | ⚠️ Never deployed | 10 epics without production deployment (web or mobile) |
| Stakeholder Acceptance | N/A | Mobile phase in progress |
| Technical Health | ✅ Solid | TanStack Query patterns consistent, shared utilities established, cache strategy consolidated |
| Unresolved Blockers | None | All code review findings resolved |
| Mobile Hook Testing | ⚠️ Gap | 8+ hooks with zero unit tests — risk accumulates with Epic 11 |

## No Significant Discoveries

Nothing from Epic 10 fundamentally changes architectural decisions. The mobile-consumes-backend pattern validated the API design. TanStack React Query patterns (`useQuery`, `useInfiniteQuery`, `useMutation` with optimistic updates) are established and should be followed consistently in future epics.

## Next Steps — Epic 11 Preparation

**Epic 11: Mobile Tracking — Mood, Tasks & Calendar**

Two stories planned:
1. **11.1: Mood Tracking Mobile** — Connect mood recording and chart visualization to `/api/v1/moods`. Uses `victory-native` for charts (weekly bar chart, 6-month trends). 9 mood categories with intensity slider.
2. **11.2: Organisation — Todo, Kanban, Timeline Mobile** — Connect three-view organisation screen to `/api/v1/boards`. Uses `react-native-draggable-flatlist` for kanban drag & drop. Calendar view with `react-native-calendars`.

**Key Risks for Epic 11:**
- `victory-native` chart integration may have React Native compatibility edge cases
- `react-native-draggable-flatlist` for kanban requires gesture handler setup and 60fps animation tuning
- Story 11.2 has 3 views (todo, kanban, chronology) in a single story — scope is larger than any Epic 10 story
- Boards API has more complex data structures (boards → columns → cards) vs flat post lists

**Recommendations from Epic 10 learnings:**
- Apply Action Item #1: explicitly specify pagination strategy for mood history and board lists
- Apply Action Item #2: document cache invalidation matrix for mood and board mutations
- Apply Action Item #3: verify API contract values (mood category names, board column statuses) against backend spec
- Consider adding lightweight hook tests given the increasing hook count

## Team Participants

- Bob (Scrum Master) — Facilitation
- Alice (Product Owner) — Business perspective
- Charlie (Senior Dev) — Technical depth
- Dana (QA Engineer) — Quality & testing
- Elena (Junior Dev) — Fresh perspective
- Axel (Project Lead) — Oversight and direction

## Retrospective Verdict

Epic 10 successfully launched the mobile phase of HomeCafe, delivering journal/posts and social feed functionality in 2 stories with zero backend modifications and zero new dependencies. The adversarial code review process caught critical functional gaps in both stories — particularly infinite scroll implementation and cache invalidation consistency — reinforcing its role as the primary quality strategy. The key insight is the "looks correct vs works correctly" gap inherent in mock-data-first mobile development: screens visually match expectations but functional behaviors (mutations, infinite scroll, cache invalidation) can be silently missing. Three action items target this gap by embedding pagination strategy, cache invalidation matrix, and API contract verification into the story template. With 10 epics and 389 tests across web and mobile, the architecture continues to hold, and the team is ready for Epic 11's more complex native integrations (charts, drag & drop, calendars).
