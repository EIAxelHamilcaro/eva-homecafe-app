# Epic 8 Retrospective — Dashboard Hub

**Date:** 2026-02-10
**Facilitator:** Bob (Scrum Master)
**Epic:** Epic 8 — Dashboard Hub
**Status:** Complete (5/5 stories done)

## Epic Summary

Epic 8 delivered the complete Dashboard Hub for HomeCafe, covering FR61-FR69. The epic created an all-in-one dashboard with 8 independent widgets (mood summary, recent posts, task overview, gallery preview, messaging preview, calendar, journal quick-compose, moodboard preview) plus contextual empty states for new users. All widgets are async Server Components wrapped in `<Suspense>` with skeleton fallbacks, enabling independent loading. The epic was pure UI + CQRS read — no new domain aggregates, no new use cases, no DI changes.

### Delivery Metrics

- Stories completed: 5/5 (100%)
- Files created: 18 new files
- Files modified: 13 files
- Tests: 349 -> 360 (+11 new tests)
- Code reviews: 5 adversarial reviews, all findings resolved
- Blockers: 0
- Production incidents: 0 (8th consecutive epic)

### Stories Delivered

| Story | Description | Files Created | Files Modified | Key Achievement |
|---|---|---|---|---|
| 8.1 | Dashboard Layout & Empty States | 11 | 1 | Foundation: Suspense grid, 8 widget slots, config-driven WidgetEmptyState, root page redirect |
| 8.2 | Mood & Journal Widgets | 2 | 5 | Fixed "use client" + async bug, mood-mini-chart, mood-config.ts extraction, error handling |
| 8.3 | Posts & Messaging Widgets | 4 | 3 | New user-posts + profile-names queries, formatRelativeTime with 11 tests, batch N+1 prevention |
| 8.4 | Tasks & Calendar Widgets | 1 | 2 | New pending-tasks query, colored calendar markers per board type, timezone bug fix |
| 8.5 | Gallery & Moodboard Widgets | 0 | 2 | Error handling consistency, photo/board count indicators |

## What Went Well

1. **Foundation + iteration pattern delivers accelerating velocity** — Story 8.1 established Server Component + Suspense + WidgetEmptyState (config-driven). Each subsequent story built on this foundation faster: 11 files -> 2 -> 4 -> 1 -> 0 new files. By Story 8.5, enhancements were minimal modifications only.

2. **Config-driven WidgetEmptyState eliminated 8x duplication** — Single component with type parameter handles all 8 widget empty states. Contextual messages and CTA links configured declaratively. Zero per-widget empty state boilerplate.

3. **8th consecutive epic with zero production incidents** — Adversarial code review continues as primary quality strategy. 5 reviews with findings resolved. Pattern validated across 8 epics.

4. **Dev Agent Records 5/5 complete** — Action item from Epic 7 retrospective ("Finalize Dev Agent Record") successfully applied. All stories have Agent Model, Completion Notes, File List, and Change Log. Contrast with Epic 7 where Story 7.1 was incomplete.

5. **Emergent patterns propagated naturally** — `Awaited<ReturnType<typeof fn>>` type inference emerged in 8.3 and was adopted in 8.4 and 8.5. `mood-config.ts` extraction (8.2) and `toPostDto` shared export (8.3) show consistent DRY refactoring instinct.

6. **CQRS read pattern scaled to 8 widgets** — All widgets (except JournalWidget) are async Server Components calling queries directly. No use cases needed for reads. Clean separation validated at dashboard scale.

## What Didn't Go Well

1. **Error handling missing in Story 8.1, retrofitted in 4 subsequent stories** — The 8 widgets created in 8.1 lacked try/catch. Stories 8.2, 8.3, 8.4, and 8.5 all added error handling retroactively. This is the 3rd consecutive epic where "error handling visible" is identified but not embedded in the story template.

2. **Wrong query used in 3/5 stories** — Story 8.1 connected posts-widget to `getJournalEntries` (private posts only, violating FR62) and tasks-widget to `getChronology` (due-date cards only, violating FR63). Stories 8.3 and 8.4 created dedicated queries to fix this. Root cause: reusing the "closest" existing query without verifying it matched the exact FR spec.

3. **"use client" + async bug in Story 8.2** — mood-widget.tsx had both `"use client"` directive and `async function` — invalid in Next.js (async components must be Server Components). Not caught by TypeScript or Biome. Required manual code review to detect.

## Key Insights

1. **Standalone action items don't work — change the mechanism (3rd confirmation)** — The "error handling visible" checklist has been carried from Epic 5 through Epic 6, Epic 7, and now Epic 8. The team consistently implements it via code review but never formalizes it in the story template. Solution: embed the checklist IN the template as a mandatory section.

2. **Query reuse requires FR verification** — "Use existing query" is not the same as "use the RIGHT query." Before connecting a widget to an existing query, verify the query's scope matches the FR exactly. 3/5 stories were impacted by this assumption gap.

3. **Foundation stories set the quality ceiling for the epic** — Story 8.1's quality patterns (or lack thereof) propagated to all 5 stories. Error handling missing in 8.1 meant 4 stories of retrofit. Investing more in the foundation story saves compound effort.

4. **Velocity accelerates within an epic when patterns are clear** — 8.1 (foundation) -> 8.2-8.4 (enhancement) -> 8.5 (polish). Each story was faster because the pattern was established. This confirms the command/query split insight from Epic 7.

5. **Code review adversarial is necessary but not sufficient** — It catches issues (100% success rate) but generates avoidable rework. Shifting quality left (into the template) reduces review burden without removing the safety net.

## Previous Retrospective Follow-Through

### Epic 7 Action Items Status

| # | Action Item | Status | Evidence |
|---|---|---|---|
| 1 | Embed quality checklists directly in the story template | ⏳ Partial | Not formally in template, but error handling applied in practice via reviews. Pattern recognized but mechanism not changed. |
| 2 | Add explicit "Finalize Dev Agent Record" task to every story | ✅ Completed | 5/5 stories have complete Dev Agent Records (Agent Model, Completion Notes, File List, Change Log) |

**Score: 1/2 completed, 1 partial (same item carried from Epic 5)**

### Epic 7 Technical Debt Status

| # | Item | Epic 8 Status | Impact |
|---|---|---|---|
| 1 | db:push not executed | Unchanged | Now 8 epics of migrations not pushed |
| 2 | Story 7.1 Dev Agent Record incomplete | Unchanged (historical) | No impact on Epic 8 |
| 3 | i18n absent | Unchanged | UI text in English, mood labels in French in code |
| 4 | `<img>` instead of `<Image>` | ⏳ Partial | Fixed in dashboard widgets (8.1), persists elsewhere |
| 5 | Biome warnings | Slight improvement | ~49 pre-existing warnings (vs ~51 in Epic 7) |

## Technical Debt

| # | Item | Severity | Description |
|---|---|---|---|
| 1 | db:push not executed | Medium | Database schema migrations generated but never pushed (8 epics). Dev local works. Production risk accumulating. |
| 2 | i18n absent | Low | UI text in English. Mood categories stored as French keys in code. Deferred to dedicated story. |
| 3 | `<img>` instead of `<Image>` | Low | Partially resolved in dashboard widgets. Pre-existing pattern using raw img tags in older components. |
| 4 | Biome warnings | Low | ~49 pre-existing warnings, primarily `noNonNullAssertion` in friend/notification tests. |
| 5 | Rich text as plain text in widget | Low | Post content (Tiptap rich text) rendered as plain text in dashboard posts-widget preview. Acceptable for widget. |

## Action Items

| # | Action | Owner | Success Criteria |
|---|---|---|---|
| 1 | Embed error handling checklist in story template as mandatory section | Bob (SM) | Story template includes "Quality Checklist" section with "Error handling visible (try/catch + fallback)" as required item. No more standalone action items. |
| 2 | Add "Verify query matches FR exactly" step to story template | Bob (SM) | Story template includes explicit step: "Before reusing an existing query, verify its scope covers the target FR completely." |

## Team Agreements

- Error handling (try/catch + empty state fallback) is MANDATORY for all async Server Components calling queries — not optional, not "to add in review"
- Before reusing an existing query, verify its scope matches the target FR EXACTLY
- `Awaited<ReturnType<typeof fn>>` is the standard pattern for typing query results in widgets
- Dev Agent Record remains a mandatory deliverable — validated across Epic 8 (5/5 complete)

## Epic 9 Preparation

### Readiness Assessment

| Area | Status | Notes |
|---|---|---|
| Domain modeling | N/A | No new aggregates — pure UI pages |
| Existing patterns | Ready | Settings reuses profile ports, landing page uses SSR |
| SEO / Lighthouse | New | Team needs familiarity with Next.js metadata API |
| Notification preferences (FR76) | Decision needed | Store toggles in DB; push activation deferred to mobile phase |
| Figma designs | Available | Mobile, Desktop, Tablet links in CLAUDE.md |
| Quality baseline | Ready | 360 tests, 0 errors, clean codebase |

### Dependencies on Epic 8

None. Epic 9 is fully standalone. Settings, contact, and landing pages do not depend on the dashboard.

### Key Technical Considerations

1. **Next.js metadata API** — `export const metadata` and `generateMetadata()` for SEO meta tags, Open Graph (Story 9.3)
2. **Lighthouse SEO 90+** — requires production build testing, semantic HTML, proper heading hierarchy
3. **Conditional auth page** — Contact page (FR77) has connected/non-connected states using optional `getSession()` instead of `requireAuth()`
4. **Notification preferences scope** — FR76 toggles saved to DB; actual push notification activation deferred to Expo EAS mobile phase

### No Significant Discoveries

Nothing from Epic 8 fundamentally changes the plan for Epic 9. The architecture is sound, UI patterns are proven, and all prerequisite modules are stable.

## Team Participants

- Bob (Scrum Master) — Facilitation
- Alice (Product Owner) — Business perspective
- Charlie (Senior Dev) — Technical depth
- Dana (QA Engineer) — Quality & testing
- Elena (Junior Dev) — Fresh perspective
- Axel (Project Lead) — Oversight and direction

## Retrospective Verdict

Epic 8 delivered the complete Dashboard Hub: 8 independent widgets with Suspense-based progressive loading, config-driven empty states, and CQRS read queries. The most significant pattern was the foundation + iteration approach — Story 8.1 established the architecture, Stories 8.2-8.5 refined each widget pair progressively. Velocity accelerated from 11 new files to 0 by the final story. 8th consecutive epic with zero production incidents. The main process learning: quality checklists MUST be embedded in the story template — 3 consecutive epics have identified this need without changing the mechanism. Epic 9 (Settings, Contact & Landing Page) has no blocking prerequisites and can start immediately. After Epic 9, the web MVP is feature-complete.
