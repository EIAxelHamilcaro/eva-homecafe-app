# Epic 11 Retrospective — Mobile Tracking: Mood, Tasks & Calendar

**Date:** 2026-02-10
**Facilitator:** Bob (Scrum Master)
**Epic:** Epic 11 — Mobile Tracking: Mood, Tasks & Calendar
**Status:** Complete (2/2 stories done)

## Epic Summary

Epic 11 continued the mobile phase of HomeCafe by connecting mood tracking and organization features to their existing backend APIs. Two stories delivered mood recording with chart visualization (11.1) and the most complex mobile screen to date — a 5-tab organisation view with todo lists, kanban boards, timings, chronology, and calendar (11.2). Both stories followed the TanStack Query patterns established in Epic 10 without any backend modifications.

### Delivery Metrics

- Stories completed: 2/2 (100%)
- Files created: 4 new files
- Files modified: 7 files
- Hooks created: 15 TanStack Query hooks (5 in 11.1, 10 in 11.2)
- Tests: 389 (0 new — mobile hooks tested via integration, no unit test additions)
- Code reviews: 2 adversarial reviews, 16 total issues (7H, 6M, 3L), all H+M fixed
- Review passes: 1 pass for 11.1, 2 passes for 11.2
- Blockers: 0
- Production incidents: 0 (11th consecutive epic)

### Stories Delivered

| Story | Description | Scope | Hooks Created | Review Issues | Passes | Key Achievement |
|-------|-------------|-------|---------------|---------------|--------|-----------------|
| 11.1 | Mood Tracking Mobile | 4 tasks, 6 files | 5 | 7 (2H, 3M, 2L) | 1 | Clean mood API integration, chart domain scaling fix |
| 11.2 | Organisation Todo/Kanban/Timeline | 4 tasks, 5 files | 10 | 9 (5H, 3M, 1L) | 2 | Most complex mobile screen (5 tabs), tap-to-move kanban UX |

## What Went Well

1. **Epic 10 action items followed through at 100% (3/3)** — First time achieving full action item completion. Pagination strategy explicitly specified in both story specs (`useQuery` for all). Cache invalidation matrix documented for every mutation hook. API contract values exhaustively documented with response shape tables. This proves the retrospective process produces real change when commitments are tracked.

2. **TanStack Query pattern fully consolidated** — 15 hooks created across 2 stories with remarkable consistency. `use-mood.ts` and `use-boards.ts` follow identical conventions as `use-journal.ts` and `use-posts.ts` from Epic 10. Query key factories, mutation invalidation, staleTime configuration — all standardized. The pattern is now a reliable copy-adapt.

3. **Story Intelligence propagation matured further** — Story 11.2 explicitly referenced learnings from 11.1, 10.1, and 10.2. SafeAreaView import source, shared utility extraction, mutation handler patterns, Alert feedback — all carried forward. 11.2's "Code Review Patterns to Follow" section prevented several repeat issues.

4. **Creative UX solutions emerged** — Story 11.2 introduced tap-to-move for kanban card cross-column moves (tap card → Alert column picker → API call), which is arguably better mobile UX than forcing drag & drop across columns. The Timings vs Chronologie differentiation (relative dates vs absolute timeline) added real value beyond the original spec.

5. **Zero backend modifications for second consecutive epic** — Both stories consumed existing APIs without changes. The REST API contract continues to work seamlessly across web and mobile, validating the API-first architecture.

6. **Zero new libraries installed for third consecutive epic** — TanStack React Query, victory-native, react-native-draggable-flatlist, react-native-calendars — all pre-installed and sufficient.

## What Didn't Go Well

1. **"Looks correct vs works correctly" pattern persists (2nd consecutive epic)** — Story 11.2 H2: Kanban tab rendered only the first board instead of all boards (`boards[0]` instead of `boards.map()`). H3: TodoWidget showed all items instead of filtering to pending only. These are functional logic bugs masked by visually correct screens. The mock-data-first approach creates an illusion of completeness that survives API connection.

2. **Record number of HIGH review issues — 7 across 2 stories** — Story 11.1 had 2 HIGH (chart domain mismatch, no success feedback). Story 11.2 had 5 HIGH (cross-column move missing, single-board rendering, pending filter missing, error states missing, optimistic rollback missing). This is the highest HIGH count in any epic.

3. **Story 11.2 required 2 review passes** — The 5 HIGH issues in 11.2 couldn't all be caught and fixed in a single review cycle. H1 (tap-to-move kanban) and M1 (Timings vs Chronologie) required a second pass. This signals that the story scope exceeded what a single review can effectively cover.

4. **Error states and user feedback systematically missing in initial implementation** — 11.1 H2: no Alert after mood recording. 11.2 H4: no retry button on 5 tabs. 11.2 M3: no Alert on mutation errors. 11.2 H5: no optimistic rollback on toggle failure. This is a recurring pattern across Epics 10 and 11 — these behaviors are consistently omitted in first implementation.

5. **Still zero mobile unit tests** — Hook count grew from 8+ (Epic 10) to 15+ (Epic 11) with zero test coverage. Testing strategy relies entirely on backend BDD tests + adversarial code review. Risk accumulates with each epic.

6. **Story 11.2 scope was too large for a single story** — 5 tabs, 10 hooks, 3 data types (todo, kanban, chronology), 2 API endpoints. This was effectively 2-3 stories packed into one. The review burden (9 issues, 2 passes) confirms the scope was excessive.

## Key Insights

1. **Retrospective action items work when tracked** — Epic 10's 3 action items were all implemented in Epic 11's story specs. The pagination strategy, cache invalidation matrix, and API contract verification are now standard. This validates the retrospective process and creates a virtuous cycle of improvement.

2. **"Looks correct vs works correctly" is a systemic issue, not a one-off** — Two consecutive epics with the same pattern. The root cause is the mock-data-first workflow: replace mock → screen looks the same → move on. Functional behaviors (filtering, multi-item rendering, error handling, rollback) are invisible in visual inspection. Requires a process change, not just awareness.

3. **Story scope directly impacts review quality** — 11.1 (standard scope) needed 1 review pass with 2 HIGH issues. 11.2 (oversized scope) needed 2 passes with 5 HIGH issues. Smaller stories produce cleaner first implementations and more effective reviews.

4. **Error states and user feedback need to be "baked in" not "added later"** — These behaviors are consistently missing across 4 stories (10.1, 10.2, 11.1, 11.2). They should be part of the story template's standard requirements, not left to code review to catch.

5. **Creative mobile UX solutions add value** — The tap-to-move kanban and Timings/Chronologie differentiation show that mobile implementations can improve on web patterns rather than simply copying them.

## Previous Retrospective Follow-Through

### Epic 10 Action Items Status

| # | Action Item | Status | Evidence |
|---|---|---|---|
| 1 | Add "infinite scroll / pagination strategy" to story template | ✅ Completed | Stories 11.1 and 11.2 explicitly specify `useQuery` for all hooks. No ambiguity. |
| 2 | Add cache invalidation matrix to story spec | ✅ Completed | 11.1: `useRecordMood()` invalidates `moodKeys.all`. 11.2: "All mutations invalidate `boardKeys.all`" documented. |
| 3 | Add "API contract values verified against spec" to Quality Checklist | ✅ Completed | Both stories include comprehensive API endpoint tables with request/response shapes. |

**Score: 3/3 completed (100%) — first time achieving full action item follow-through**

### Epic 10 Technical Debt Status

| # | Item | Epic 11 Status | Impact |
|---|---|---|---|
| 1 | db:push not executed | Unchanged | Now 11 epics of migrations not pushed. |
| 2 | DeleteAccountUseCase missing | Unchanged | Tracked for Epic 15. |
| 3 | /og-landing.png missing | Unchanged | Tracked for Epic 15. |
| 4 | i18n not wired | Unchanged | Tracked for Epic 15. |
| 5 | Rich text as plain text in widget | Unchanged | Dashboard concern. |
| 6 | Mobile hooks have zero unit tests | Worsened | 8+ hooks → 15+ hooks with zero tests. |
| 7 | Cache invalidation not systematically documented | Resolved | Now documented in every story spec. |

## Technical Debt

| # | Item | Severity | Description |
|---|---|---|---|
| 1 | db:push not executed | Medium | Database schema migrations generated but never pushed (11 epics). |
| 2 | DeleteAccountUseCase missing | Medium | Tracked for Epic 15. |
| 3 | /og-landing.png missing | Medium | Tracked for Epic 15. |
| 4 | i18n not wired | Low | Tracked for Epic 15. |
| 5 | Rich text as plain text in widget | Low | Dashboard concern. |
| 6 | Mobile hooks have zero unit tests | Medium | 15+ TanStack Query hooks with zero test coverage. Risk grows each epic. |
| 7 | useMoodStats hook unused (dead code) | Low | May be needed for Epic 13 dashboard. |
| 8 | MoodWeekEntry.dayOfWeek typed as string | Low | Should be union type, low risk. |

## Action Items

| # | Action | Owner | Success Criteria |
|---|---|---|---|
| 1 | Add AC-by-AC functional verification checklist to story template | Bob (SM) | Every story spec includes a "Functional Verification Checklist" section. Dev must verify each AC functionally (not just visually) before passing to review. |
| 2 | Add error states + user feedback as standard review checklist items | Bob (SM) | Code review checklist explicitly includes: "Error state with retry on every screen?", "Success/error Alert after every mutation?", "Optimistic UI with rollback?" |
| 3 | Limit story scope to max 3 tabs/views per story | Alice (PO) + Bob (SM) | No story combines more than 3 views in a single screen. If scope exceeds, split into 2 stories. |
| 4 | Document mobile upload flow before Epic 12 | Charlie (Dev) | Document expo-image-picker → resize → presigned URL → R2 upload flow. Validates ApiClient.uploadFile exists and works. |
| 5 | Update sprint-status.yaml: epic-11 → done | Bob (SM) | Sprint status reflects completed epic. |

## Team Agreements

- Every story spec includes a Functional Verification Checklist — devs verify each AC functionally before requesting review
- Error states (with retry), success/error Alerts, and optimistic rollback are mandatory in every screen — not optional extras
- Story scope limited to 3 views/tabs maximum — split larger stories proactively
- Story Intelligence continues to propagate and is verified in each story spec
- All Epic 10 agreements remain in force (pagination strategy, cache invalidation matrix, API contract verification)

## Readiness Assessment

| Area | Status | Notes |
|------|--------|-------|
| Testing & Quality | ✅ Clean | 389 tests, 0 regressions, 0 Biome errors |
| Deployment | ⚠️ Never deployed | 11 epics without production deployment |
| Stakeholder Acceptance | N/A | Mobile phase in progress |
| Technical Health | ✅ Solid | TanStack Query patterns consolidated, 15 hooks consistent |
| Unresolved Blockers | None | All H+M review findings resolved |
| Mobile Hook Testing | ⚠️ Gap | 15+ hooks with zero unit tests |

## No Significant Discoveries

Nothing from Epic 11 fundamentally changes architectural decisions. The mobile-consumes-backend pattern continues to validate the API design. TanStack Query patterns are now thoroughly established (15+ hooks across 2 epics). The tap-to-move kanban UX is a mobile-specific improvement that doesn't affect backend or architecture.

## Next Steps — Epic 12 Preparation

**Epic 12: Mobile Visual — Gallery & Moodboards**

Two stories planned:
1. **12.1: Photo Gallery Mobile** — Connect gallery to `/api/v1/gallery`. Uses `expo-image-picker` for photo selection, shared upload endpoint for R2 storage. Gallery screen is placeholder.
2. **12.2: Moodboard Management Mobile** — Connect moodboard to `/api/v1/moodboards`. Pin images (via upload) and colors. Moodboard has partial UI with mock data.

**Preparation Tasks:**
- [ ] Verify `ApiClient.uploadFile` exists in `apps/expo/lib/api/client.ts`
- [ ] Test expo-image-picker → R2 upload flow in isolation (spike)
- [ ] Study Moodboard API contract (endpoints, DTOs, pin types)
- [ ] Update sprint-status.yaml: epic-11 → done

**Key Risks for Epic 12:**
- First mobile story involving file upload (expo-image-picker → presigned R2 URL)
- expo-camera integration for photo capture (hardware-dependent)
- Moodboard pin types (image vs color) have different creation flows
- Upload error handling and retry UX on mobile

**Recommendations from Epic 11 learnings:**
- Apply Action Item #1: include functional verification checklist in both story specs
- Apply Action Item #2: error states and feedback in review checklist
- Apply Action Item #3: each story should have max 3 views — Gallery (1 view) and Moodboard (2 views: list + detail) fit within limits
- Document the upload flow before starting (Action Item #4)

## Team Participants

- Bob (Scrum Master) — Facilitation
- Alice (Product Owner) — Business perspective
- Charlie (Senior Dev) — Technical depth
- Dana (QA Engineer) — Quality & testing
- Elena (Junior Dev) — Fresh perspective
- Axel (Project Lead) — Oversight and direction

## Retrospective Verdict

Epic 11 successfully delivered mood tracking and the most complex mobile organisation screen (5 tabs, 10 hooks) with zero backend modifications and zero regressions. The highlight is achieving 100% follow-through on Epic 10's action items — proving that retrospectives produce real, measurable improvement when commitments are tracked. The main concern is the persistent "looks correct vs works correctly" pattern (2nd consecutive epic) producing a record 7 HIGH review issues. Three new action items target this: a functional verification checklist per AC, mandatory error/feedback review items, and story scope limits. With 15+ hooks and 389 stable tests, the architecture holds strong. The team is ready for Epic 12's upload-focused stories, pending validation of the mobile upload flow.
