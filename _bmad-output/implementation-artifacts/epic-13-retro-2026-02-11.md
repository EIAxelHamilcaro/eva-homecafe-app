# Epic 13 Retrospective — Mobile Gamification & Dashboard

**Date:** 2026-02-11
**Facilitator:** Bob (Scrum Master)
**Epic:** Epic 13 — Mobile Gamification & Dashboard
**Status:** Complete (2/2 stories done)

## Epic Summary

Epic 13 delivered mobile implementations of sticker/badge collections and dashboard widget real API connections, completing the transition from mock data to fully live data across all dashboard widgets. Story 13.1 created an elegant API-to-SVG visual mapping layer for the reward system. Story 13.2 connected the remaining 4 dashboard widgets (messagerie, suivi, journal, calendar) and deleted the entire mock data file. Zero backend modifications for the 4th consecutive epic, zero new libraries for the 5th consecutive epic, 13th consecutive epic without production incidents.

### Delivery Metrics

- Stories completed: 2/2 (100%)
- Files created: 5 new files
- Files modified: ~14 files
- Files deleted: 1 (dashboard-mock-data.ts)
- Hooks created: 2 (useStickers, useBadges)
- Hooks connected: 5 existing (useUnreadCount, useMoodTrends, useMoodWeek, useJournalStreak, useChronology)
- Tests: 389 (0 new — mobile hooks tested via integration, no unit test additions)
- Code reviews: 2 adversarial reviews, all issues fixed in single pass each
- Review passes: 1 pass each (maintaining Epic 12 improvement)
- Blockers: 0
- Production incidents: 0 (13th consecutive epic)

### Stories Delivered

| Story | Description | Scope | Review Issues | Passes | Key Achievement |
|-------|-------------|-------|---------------|--------|-----------------|
| 13.1 | Stickers & Badge Collections Mobile | 7 tasks, 12 files | 7 (3H, 2M, 2L) | 1 | API-to-SVG visual mapping layer, earned/unearned states, rewards dashboard widget |
| 13.2 | Dashboard Widgets Real API Connection | 6 tasks, 6 files | 7 (1H, 4M, 2L) | 1 | All dashboard widgets on real data, mock data file deleted entirely |

## What Went Well

1. **Dashboard 100% connected — zero mock data remaining** — Story 13.2 completed the transition from mock to real data across all dashboard widgets. The entire `dashboard-mock-data.ts` file was deleted. This is a significant UX milestone — users now see live, accurate data everywhere.

2. **Elegant API-to-SVG visual mapping** — Story 13.1 created `reward-visuals.ts` mapping all 19 achievement keys to existing SVG component props (11 sticker types, 8 badge configs) with fallback defaults. This decouples API data from visual representation and is extensible for future achievements without touching components.

3. **Single review pass maintained (2nd consecutive epic)** — Both stories passed code review in 1 pass, continuing the improvement from Epic 12. The established patterns (loading skeletons, error states, pull-to-refresh) are well understood.

4. **Zero backend modifications (4th consecutive epic)** — The REST API contract continues to serve both web and mobile seamlessly, validating the API-first architecture.

5. **Zero new libraries (5th consecutive epic)** — All features implemented with existing dependencies. TanStack Query, NativeWind, lucide-react-native, and react-native-svg covered all needs.

6. **Graceful degradation pattern for widgets** — New pattern in 13.2: widgets render their structure even when API calls fail, showing "—" or skeleton states. This is production-quality resilience.

7. **Clean implementation with minimal debug issues** — 13.1 had zero debug log entries. 13.2 had only minor Biome and TypeScript issues (noArrayIndexKey, string|undefined from split).

## What Didn't Go Well

1. **Loading/error/retry states still omitted in first implementation (4th consecutive epic)** — Story 13.1 H1: ActivityIndicator instead of loading skeletons. Story 13.2 H1: no retry on error for all 4 widgets. The pattern persists: secondary UX states are consistently missed in first pass and caught in review. This is a systemic process gap, not a skill gap.

2. **Timezone/date manipulation bugs** — Story 13.2 had timezone bugs in 2 of 4 widgets: monthly chart month offset and calendar `split('T')[0]` returning `string | undefined`. Native Date manipulation without a centralized utility is fragile and error-prone.

3. **French pluralization rendering bug** — Story 13.2 M1: conditional 's' on "message non lu(s)" was incorrectly rendered. Highlights the growing i18n fragility as French-language UI strings multiply.

4. **AC-by-AC functional verification checklist still not implemented (carried over 3x from Epic 11)** — While not applicable to Epic 13 (no pagination, no user input), the checklist was never added to the story template. It remains untested after 3 epics.

5. **Missing earned indicator on earned items** — Story 13.1 H2: earned stickers/badges had no visual checkmark indicator despite AC #6 explicitly requiring "visually distinct" earned items. Core AC missed in first implementation.

## Key Insights

1. **Epic 13's simplicity masked process weaknesses** — With only read-only data fetching and no pagination/input, the carried-over action items (verification checklist, useInfiniteQuery default, client-side validation) were never tested. The team had a false sense of security.

2. **The "100% complete" standard requires structural verification** — Project Lead Axel set the bar: nothing missing, no catching up in review. This demands a checklist-driven approach, not reliance on review as a safety net.

3. **Epic 14 will be the true maturity test** — 4 stories with new infrastructure (push notifications, camera permissions, deep linking), potential backend work for the first time in 4 epics, and significantly more complexity than Epic 13.

4. **Technical debt is accumulating silently** — 22+ mobile hooks with zero test coverage (growing every epic), 13 epics without production deployment, date manipulation without centralized utilities. Each item is manageable alone but the aggregate risk is increasing.

5. **Graceful degradation is a positive pattern evolution** — The widget resilience pattern from 13.2 shows the team is thinking about production scenarios beyond happy path. This maturity should carry into Epic 14.

## Previous Retrospective Follow-Through

### Epic 12 Action Items Status

| # | Action Item | Status | Evidence |
|---|---|---|---|
| 1 | IMPLEMENT AC-by-AC functional verification checklist (CARRIED OVER from Epic 11) | ⚠️ Not applicable | No paginated lists or user inputs in Epic 13. Checklist still not added to template. Not testable this iteration, but also not implemented. |
| 2 | Replace useQuery with useInfiniteQuery as default for paginated lists | ✅ N/A (correct) | 13.1 explicitly notes "No pagination needed — <50 items, use useQuery". 13.2 = single-value reads. Correct pattern applied. |
| 3 | Add "Client-Side Validation Checklist" to story template | ⚠️ Not applicable | No user input features in Epic 13. Not testable this iteration. |
| 4 | Update sprint-status.yaml: epic-12 → done | ✅ Completed | Sprint status shows epic-12: done. |

**Score: 2/4 completed, 2 not applicable (N/A does not mean completed — template changes were not made)**

### Epic 12 Technical Debt Status

| # | Item | Epic 13 Status | Impact |
|---|---|---|---|
| 1 | db:push not executed | Worsened | Now 13 epics of migrations not pushed. |
| 2 | DeleteAccountUseCase missing | Unchanged | Tracked for Epic 15. |
| 3 | /og-landing.png missing | Unchanged | Tracked for Epic 15. |
| 4 | i18n not wired | Worsened | French pluralization bug in 13.2 confirms growing need. |
| 5 | Rich text as plain text in widget | Unchanged | Dashboard concern. |
| 6 | Mobile hooks zero unit tests | Worsened | 20+ → 22+ hooks with zero tests. |
| 7 | useMoodStats hook unused (dead code) | To verify | May have been used by 13.2 dashboard connection. |
| 8 | MoodWeekEntry.dayOfWeek typed as string | Unchanged | Low risk. |

## Technical Debt

| # | Item | Severity | Description |
|---|---|---|---|
| 1 | db:push not executed | Medium | Database schema migrations generated but never pushed (13 epics). |
| 2 | DeleteAccountUseCase missing | Medium | Tracked for Epic 15. |
| 3 | /og-landing.png missing | Medium | Tracked for Epic 15. |
| 4 | i18n not wired | Medium | French pluralization bugs confirm growing need. Upgraded from Low. |
| 5 | Rich text as plain text in widget | Low | Dashboard concern. |
| 6 | Mobile hooks zero unit tests | High | 22+ TanStack Query hooks with zero test coverage. Risk grows each epic. Upgraded from Medium. |
| 7 | useMoodStats hook unused (dead code) | Low | Verify if used by 13.2. |
| 8 | MoodWeekEntry.dayOfWeek typed as string | Low | Should be union type, low risk. |
| 9 | Date manipulation without centralized utility | Medium | NEW — Timezone bugs in 2/4 widgets (13.2). Native Date parsing is fragile. |
| 10 | sprint-status.yaml epic-13 still in-progress | Low | Should be updated to done. |

## Action Items

| # | Action | Owner | Success Criteria |
|---|---|---|---|
| 1 | IMPLEMENT AC-by-AC functional verification checklist in story template (CARRIED OVER 3x — FINAL CARRY, BLOCKING) | Bob (SM) | Every story spec contains a "Functional Verification Checklist" section with one checkbox per AC. Dev must verify each AC functionally before requesting review. NO STORIES CREATED without this section. |
| 2 | Add "Loading/Error/Empty States" as mandatory section in story template | Bob (SM) | Every story spec lists the 3 states (loading skeleton, error + retry, empty state) for each screen/widget. Eliminates the 4-epic recurring omission pattern. |
| 3 | Backend audit for Epic 14: verify all required endpoints exist | Charlie (Senior Dev) | Documented list of existing vs to-create endpoints for all 4 Epic 14 stories. Specifically: /api/v1/settings (PATCH), push token registration, forgot/reset password flow, friend QR endpoints. |
| 4 | Update sprint-status.yaml: epic-13 → done | Bob (SM) | sprint-status.yaml reflects epic-13: done. |

## Team Agreements

- The AC-by-AC functional verification checklist is BLOCKING — no Epic 14 stories created without it in template
- Loading/error/empty states are first-class requirements, not review catches
- Project Lead standard: 100% complete, nothing missing — no "catch it in review" mentality
- Backend audit BEFORE story creation — no assumptions about endpoint availability
- All Epic 10, 11, and 12 agreements remain in force (pagination strategy, cache invalidation, API contract verification, error states mandatory, scope limit 3 views, useInfiniteQuery default for lists, client-side validation)

## No Significant Discoveries

Nothing from Epic 13 fundamentally changes architectural decisions for Epic 14. The mobile-consumes-backend pattern continues to validate. Dashboard is fully connected (prerequisite for Epic 14 polish features). Reward system functions correctly (prerequisite for push notifications about badges). TanStack Query patterns are thoroughly established (22+ hooks across 4 epics). The direction is sound.

## Readiness Assessment

| Area | Status | Notes |
|------|--------|-------|
| Testing & Quality | ⚠️ Partial | 389 tests, 0 regressions, but 22+ mobile hooks at zero coverage |
| Deployment | ⚠️ Never deployed | 13 epics without production deployment — risk growing |
| Stakeholder Acceptance | N/A | Mobile phase in progress |
| Technical Health | ✅ Solid | Dashboard 100% connected, patterns established, graceful degradation |
| Unresolved Blockers | ⚠️ Minor | sprint-status needs update, date utility not centralized |
| Mobile Hook Testing | ⚠️ Gap critical | 22+ hooks with zero unit tests — upgraded to High severity |

## Next Steps — Epic 14 Preparation

**Epic 14: Mobile Polish — Settings, Push & QR**

Four stories planned:
1. **14.1: Settings & Preferences (Mobile)** — Connect settings screen to /api/v1/settings
2. **14.2: Push Notifications — Expo EAS** — Full push infrastructure (tokens, permissions, delivery)
3. **14.3: Friend QR Scanning & Deep Links** — QR scanner + deep links (expo-camera)
4. **14.4: Auth Polish — Forgot & Reset Password** — Mobile password recovery flow

**Critical Preparation Tasks:**
- [ ] Backend audit: verify endpoints for all 4 stories (Charlie)
- [ ] Evaluate if 14.2 requires new backend work — IPushNotificationProvider (Charlie)
- [ ] Update story template with AC checklist, Loading/Error/Empty states, Client-Side Validation (Bob)
- [ ] Update sprint-status.yaml: epic-13 → done (Bob)

**Parallel Preparation Tasks:**
- [ ] Spike: Expo EAS push notification setup and token registration flow (Charlie)
- [ ] Spike: expo-router deep linking configuration (Elena)
- [ ] Research: expo-camera for QR scanning — installation needed? (Elena)
- [ ] Audit: verify useMoodStats hook usage after 13.2 (cleanup if unused)

**Key Risks for Epic 14:**
- 4 stories (double Epic 13 scope) with significantly more complexity
- Push notifications = new infrastructure (potential first backend modification in 5 epics)
- QR scanning = potential first new library in 6 epics (expo-camera)
- Camera permissions + deep linking = native complexity not yet encountered
- AC verification checklist untested for 3 epics — Epic 14 is the real test

**Recommendations:**
- Apply ALL carried-over action items BEFORE creating stories — non-negotiable
- Conduct backend audit BEFORE story creation — identify backend gaps early
- Consider splitting 14.2 (Push) if backend work is required — separate backend story from mobile story
- Run spikes for push notifications and deep linking before story estimation

## Team Participants

- Bob (Scrum Master) — Facilitation
- Alice (Product Owner) — Business perspective
- Charlie (Senior Dev) — Technical depth
- Dana (QA Engineer) — Quality & testing
- Elena (Junior Dev) — Fresh perspective
- Axel (Project Lead) — Direction and vision

## Retrospective Verdict

Epic 13 successfully delivered mobile gamification and dashboard API connections, achieving the milestone of a fully live dashboard with zero mock data remaining. The highlight is the complete mock-to-real transition across all widgets, plus an elegant API-to-SVG visual mapping for the reward system. The epic benefited from established patterns and simple scope (read-only data, no pagination, no user input), which masked the fact that carried-over process improvements (AC verification checklist, client-side validation template) were never implemented — they simply weren't tested. The main concern going into Epic 14 is that these untested process improvements become critical: push notifications require infrastructure, QR scanning requires device permissions, and settings require user input — all scenarios where the missing checklists would matter. Technical debt continues to accumulate (22+ untested hooks upgraded to High severity, 13 epics undeployed, new date utility gap). Project Lead Axel's directive — "100% complete, nothing missing" — sets a clear standard that demands structural verification, not talent-based catching. The team is technically ready for Epic 14 pending backend audit and template updates.
